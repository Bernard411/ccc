<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nyasa Box - Music Sharing Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<style>
    body {
    background-color: #f8f9fa;
}

.card {
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s;
}

.card:hover {
    transform: translateY(-5px);
}

.navbar-brand {
    font-weight: bold;
    font-size: 1.5rem;
}

.track-field {
    margin-bottom: 10px;
}

.audio-player {
    width: 100%;
    margin: 20px 0;
}

.comments {
    max-height: 400px;
    overflow-y: auto;
}
</style>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="{% url 'index' %}">Nyasa Box</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'index' %}">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'blog_list' %}">Blogs</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'upload' %}">Upload</a>
                    </li>
                </ul>
                <form class="d-flex me-2" action="{% url 'search' %}" method="GET">
                    <input class="form-control me-2" type="search" name="q" placeholder="Search music..." aria-label="Search">
                    <button class="btn btn-outline-light" type="submit">Search</button>
                </form>
                <ul class="navbar-nav">
                    {% if user.is_authenticated %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            {{ user.username }}
                        </a>
                       <!-- Replace the dropdown menu in the navbar -->
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{% url 'profile' %}">Profile</a></li>
                            <li><a class="dropdown-item" href="{% url 'my_uploads' %}">My Uploads</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form method="post" action="{% url 'logout' %}" class="d-inline">
                                    {% csrf_token %}
                                    <button type="submit" class="dropdown-item">Logout</button>
                                </form>
                            </li>
                        </ul>

                        
                    </li>
                    <!-- In the navbar -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                        Distribution
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url 'distribution_request' %}">Request Distribution</a></li>
                        <li><a class="dropdown-item" href="{% url 'distribution_history' %}">Distribution History</a></li>
                        {% if user.is_staff %}
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{% url 'admin_distribution_requests' %}">Admin Dashboard</a></li>
                        {% endif %}
                    </ul>
                </li>
                    {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'login' %}">Login</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'register' %}">Register</a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <main class="container my-4">
        {% block content %}
        {% endblock %}
    </main>

    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5>Nyasa Box</h5>
                    <p>Share your music with the world. Discover new sounds.</p>
                </div>
                <div class="col-md-4">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="{% url 'index' %}" class="text-light">Home</a></li>
                        <li><a href="{% url 'blog_list' %}" class="text-light">Blogs</a></li>
                        <li><a href="{% url 'upload' %}" class="text-light">Upload Music</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Connect With Us</h5>
                    <div class="d-flex gap-3">
                        <a href="#" class="text-light"><i class="bi bi-facebook fs-4"></i></a>
                        <a href="#" class="text-light"><i class="bi bi-twitter fs-4"></i></a>
                        <a href="#" class="text-light"><i class="bi bi-instagram fs-4"></i></a>
                        <a href="#" class="text-light"><i class="bi bi-youtube fs-4"></i></a>
                    </div>
                </div>
            </div>
            <hr class="my-4">
            <p class="text-center mb-0">&copy; 2023 Nyasa Box. All rights reserved.</p>
        </div>
    </footer>
<script>
    // Multiple file upload functionality
document.addEventListener('DOMContentLoaded', function() {
    // Add track field
    const addTrackButton = document.getElementById('add-track');
    if (addTrackButton) {
        addTrackButton.addEventListener('click', function() {
            const trackFields = document.getElementById('track-fields');
            const newField = document.createElement('div');
            newField.className = 'track-field mb-2';
            newField.innerHTML = `
                <div class="input-group">
                    <input type="file" name="track_files[]" class="form-control" accept="audio/*" required>
                    <input type="number" name="track_numbers[]" class="form-control" placeholder="Track #" min="1" required>
                    <button type="button" class="btn btn-danger remove-track">Remove</button>
                </div>
            `;
            trackFields.appendChild(newField);
            
            // Add event listener to remove button
            newField.querySelector('.remove-track').addEventListener('click', function() {
                trackFields.removeChild(newField);
            });
        });
    }
    
    // Remove track field
    document.querySelectorAll('.remove-track').forEach(button => {
        button.addEventListener('click', function() {
            this.closest('.track-field').remove();
        });
    });
    
    // Album form submission with multiple files
    const albumForm = document.getElementById('albumForm');
    if (albumForm) {
        albumForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validate track numbers are unique
            const trackNumbers = Array.from(document.querySelectorAll('input[name="track_numbers[]"]'))
                .map(input => parseInt(input.value));
            
            const uniqueNumbers = new Set(trackNumbers);
            if (uniqueNumbers.size !== trackNumbers.length) {
                alert('Track numbers must be unique!');
                return;
            }
            
            // If validation passes, submit the form
            this.submit();
        });
    }
});
</script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/upload.js"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>